/*! Fabrik */

define(["jquery"],(function(t){return new Class({options:{userid:0,mode:"",formid:0},Implements:[Events,Options],initialize:function(t,i){self=this,i.element=t,this.setOptions(i),!1!==this.options.canRate&&"creator-rating"!==this.options.mode&&(Fabrik.addEvent("fabrik.list.submit.ajax.complete",(function(){self.addEvents(self.options.id)})),this.options.id=t,this.addEvents(t))},addEvents:function(t){this.col=$$("."+t),this.origRating={},this.col.each(function(t){var i=t.getElements(".starRating");i.each(function(n){n.addEvent("mouseover",function(s){this.origRating[t.id]=n.getParent(".fabrikRating").getElement(".ratingScore").innerHTML.toInt(),i.each(function(t){this._getRating(n)>=this._getRating(t)?t.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):t.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this)),n.addEvent("mouseout",function(n){i.each(function(i){this.origRating[t.id]>=this._getRating(i)?i.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):i.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this))}.bind(this)),i.each(function(t){t.addEvent("click",function(i){this.doAjax(i,t)}.bind(this))}.bind(this))}.bind(this))},_getRating:function(t){return t.get("data-rating").toInt()},doAjax:function(t,i){t.stop(),this.rating=this._getRating(i);var n=i.getParent(".fabrikRating");Fabrik.loader.start(n);var s=document.id(i).getParent(".fabrik_row"),o=s.id.split("_")[s.id.split("_").length-1],a={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"rating",g:"element",method:"ajax_rate",formid:this.options.formid,element_id:this.options.elid,row_id:o,elementname:this.options.elid,userid:this.options.userid,rating:this.rating,mode:this.options.mode};new Request({url:"",data:a,onComplete:function(t){this.rating=Math.round(parseFloat(t)),Fabrik.loader.stop(n),i.getParent(".fabrikRating").getElement(".ratingScore").set("html",t),i.getParent(".fabrikRating").getElements(".starRating").each(function(t){this.rating>=this._getRating(t)?t.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):t.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this)}).send()}})}));